<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>On&Home</title>
  <link rel="stylesheet" href="/css/import.css" />
  <script src="/js/oncommon.js"></script>
</head>
<body>
  <!-- 백그라운드 -->
  <div class="on-main-wrap">
    <!-- 헤더 -->
      <div th:replace="~{fragments/header :: header}"></div>


     <!-- 아이템영역2  -->
    <div class="on-item02 mb-80 mt-80">
      <div class="on-item02-inner">
        <h2 class="sub-title line-under">공지사항</h2>
        
          <!-- ✅ 공지사항은 검색 기능 제외 -->
          <div class="grid">
            <table>
              <colgroup>
                <col width="10%">
                <col>
                <col width="20%">
                <col width="20%">
              </colgroup>
              <thead>
                <tr>
                  <th scope="col">번호</th>
                  <th scope="col">제목</th>
                  <th scope="col">작성자</th>
                  <th scope="col">작성일자</th>
                </tr>
              </thead>
              <tbody>
                <tr th:if="${#lists.isEmpty(noticeList)}">
                  <td colspan="4" class="center">등록된 공지사항이 없습니다.</td>
                </tr>
                <tr th:each="notice, iterStat : ${noticeList}">
                  <td class="center" th:text="${#lists.size(noticeList) - iterStat.index}">번호</td>
                  <td class="center">
                    <a th:href="@{/user/board/notice/detail/{id}(id=${notice.id})}" th:text="${notice.title}">제목</a>
                  </td>
                  <td class="center" th:text="${notice.writer != null ? notice.writer : 'admin'}">작성자</td>
                  <td class="center" th:text="${#temporals.format(notice.createdAt, 'yyyy-MM-dd')}">작성일자</td>
                </tr>
              </tbody>
            </table>
          </div>                 
      </div>
    </div>
      <div th:replace="~{fragments/footer :: footer}"></div>
  </div>

  <script>
    /**
     * 카테고리 데이터
     */
    const categoryData = [
      {
        parentName: 'TV/오디오',
        children: ['TV', '오디오']
      },
      {
        parentName: '주방가전',
        children: ['냉장고', '전자렌지', '식기세척기']
      },
      {
        parentName: '생활가전',
        children: ['세탁기', '청소기']
      },
      {
        parentName: '에어컨/공기청정기',
        children: ['에어컨', '공기청정기']
      },
      {
        parentName: '기타',
        children: ['정수기', '안마의자', 'PC']
      }
    ];

    /**
     * 페이지 로드
     */
    document.addEventListener('DOMContentLoaded', function() {
      loadCategoryMenu();
      loadHeaderNavigation();
    });

    /**
     * 카테고리 메뉴 로드
     */
    function loadCategoryMenu() {
      const categoryMenu = document.getElementById('categoryMenu');
      categoryMenu.innerHTML = '';

      categoryData.forEach(category => {
        const li = document.createElement('li');
        
        const parentLink = document.createElement('a');
        parentLink.href = '#';
        parentLink.textContent = category.parentName;
        parentLink.onclick = function(e) {
          e.preventDefault();
          return false;
        };
        
        li.appendChild(parentLink);
        
        if (category.children && category.children.length > 0) {
          const depth2 = document.createElement('ul');
          depth2.className = 'depth2';
          
          category.children.forEach(child => {
            const childLi = document.createElement('li');
            const childLink = document.createElement('a');
            childLink.href = `/user/product/category?category=${encodeURIComponent(child)}`;
            childLink.textContent = child;
            childLi.appendChild(childLink);
            depth2.appendChild(childLi);
          });
          
          li.appendChild(depth2);
        }
        
        categoryMenu.appendChild(li);
      });
    }

    /**
     * 헤더 네비게이션 로드
     */
    function loadHeaderNavigation() {
      fetch('/api/user/session-info')
        .then(response => response.json())
        .then(data => {
          const headerNav = document.getElementById('headerNav');
          headerNav.innerHTML = '';

          if (data.loggedIn) {
            let navHTML = `
              <li><a href="/user/my_page">마이페이지</a></li>
              <li><a href="/user/board/notice/list">공지사항</a></li>
            `;

            if (data.isAdmin) {
              navHTML += `<li><a href="/admin/dashboard"><b>관리자</b></a></li>`;
            }

            navHTML += `
              <li><a href="#" onclick="handleLogout(); return false;">로그아웃</a></li>
            `;

            headerNav.innerHTML = navHTML;
          } else {
            headerNav.innerHTML = `
              <li><a href="/login">로그인</a></li>
              <li><a href="/signup">회원가입</a></li>
              <li><a href="/user/board/notice/list">공지사항</a></li>
            `;
          }
        })
        .catch(error => {
          console.error('세션 정보 조회 실패:', error);
          const headerNav = document.getElementById('headerNav');
          headerNav.innerHTML = `
            <li><a href="/login">로그인</a></li>
            <li><a href="/signup">회원가입</a></li>
            <li><a href="/user/board/notice/list">공지사항</a></li>
          `;
        });
    }

    /**
     * 로그아웃 처리
     */
    function handleLogout() {
      if (confirm('로그아웃 하시겠습니까?')) {
        window.location.href = '/logout';
      }
    }
  </script>
</body>
</html>
