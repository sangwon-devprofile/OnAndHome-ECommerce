/**
 * ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ ê´€ë¦¬ Slice
 *
 * ========================================
 * ğŸ“Œ íŒŒì¼ ê°œìš”
 * ========================================
 * - íŒŒì¼ ìœ„ì¹˜: src/store/slices/cartSlice.js
 * - ì—­í• : ì¥ë°”êµ¬ë‹ˆ ê´€ë ¨ ì „ì—­ ìƒíƒœ ë° ì•¡ì…˜ ê´€ë¦¬
 * - ë¼ì´ë¸ŒëŸ¬ë¦¬: Redux Toolkit (createSlice)
 *
 * ========================================
 * ğŸ“Œ ìƒíƒœ êµ¬ì¡° (State Shape)
 * ========================================
 * {
 *   items: CartItem[],     // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ë°°ì—´
 *   totalItems: number,    // ì´ ì•„ì´í…œ ìˆ˜ëŸ‰ (ê°œìˆ˜ í•©ê³„)
 *   totalPrice: number,    // ì´ ê¸ˆì•¡ (í• ì¸ê°€ ì ìš©)
 *   loading: boolean,      // API í˜¸ì¶œ ì¤‘ ì—¬ë¶€
 *   error: string | null   // ì—ëŸ¬ ë©”ì‹œì§€
 * }
 *
 * ========================================
 * ğŸ“Œ CartItem ê°ì²´ êµ¬ì¡°
 * ========================================
 * {
 *   id: number,            // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ PK (cart_item.id)
 *   product: {             // ìƒí’ˆ ì •ë³´ (EAGER ë¡œë”©)
 *     id: number,
 *     name: string,
 *     price: number,       // ì •ê°€
 *     salePrice: number,   // í• ì¸ê°€ (ì—†ìœ¼ë©´ null)
 *     thumbnailImage: string
 *   },
 *   quantity: number       // ìˆ˜ëŸ‰
 * }
 *
 * ========================================
 * ğŸ“Œ ì œê³µ ì•¡ì…˜ (Actions)
 * ========================================
 * | ì•¡ì…˜ëª…          | ê¸°ëŠ¥                    | payload                    |
 * |----------------|------------------------|----------------------------|
 * | setCartItems   | ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ì„¤ì •       | CartItem[]                 |
 * | addCartItem    | ì•„ì´í…œ ì¶”ê°€             | CartItem                   |
 * | updateCartItem | ìˆ˜ëŸ‰ ë³€ê²½               | { cartItemId, quantity }   |
 * | removeCartItem | ì•„ì´í…œ ì‚­ì œ             | cartItemId (number)        |
 * | clearCart      | ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°          | ì—†ìŒ                        |
 * | setLoading     | ë¡œë”© ìƒíƒœ ë³€ê²½          | boolean                    |
 * | setError       | ì—ëŸ¬ ìƒíƒœ ë³€ê²½          | string | null              |
 *
 * ========================================
 * ğŸ“Œ ì‚¬ìš© ì»´í¬ë„ŒíŠ¸
 * ========================================
 * - Cart.js: ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€
 * - CartSidePanel.js: ì‚¬ì´ë“œ íŒ¨ë„
 * - CartFloatingButton.js: í”Œë¡œíŒ… ë²„íŠ¼ ë°°ì§€
 * - Header.js: í—¤ë” ì¥ë°”êµ¬ë‹ˆ ì•„ì´ì½˜
 */

import { createSlice } from '@reduxjs/toolkit';

/**
 * ì´ˆê¸° ìƒíƒœ ì •ì˜
 *
 * ì•± ì‹œì‘ ì‹œ ë˜ëŠ” clearCart í˜¸ì¶œ ì‹œ ì´ ìƒíƒœë¡œ ì´ˆê¸°í™”ë¨
 */
const initialState = {
  items: [],          // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ë°°ì—´ (ë¹ˆ ë°°ì—´ë¡œ ì‹œì‘)
  totalItems: 0,      // ì´ ìˆ˜ëŸ‰ (ëª¨ë“  ì•„ì´í…œì˜ quantity í•©ê³„)
  totalPrice: 0,      // ì´ ê¸ˆì•¡ (í• ì¸ê°€ ì ìš©ëœ ê¸ˆì•¡)
  loading: false,     // API í˜¸ì¶œ ì¤‘ ì—¬ë¶€
  error: null,        // ì—ëŸ¬ ë©”ì‹œì§€ (ì •ìƒ ì‹œ null)
};

/**
 * Cart Slice ìƒì„±
 *
 * createSlice: ë¦¬ë“€ì„œì™€ ì•¡ì…˜ì„ í•œ ë²ˆì— ìƒì„±í•˜ëŠ” Redux Toolkit í•¨ìˆ˜
 * - name: ì•¡ì…˜ íƒ€ì…ì˜ ì ‘ë‘ì‚¬ (ì˜ˆ: 'cart/setCartItems')
 * - initialState: ì´ˆê¸° ìƒíƒœ
 * - reducers: ìƒíƒœ ë³€ê²½ ë¡œì§ (Immer ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë¶ˆë³€ì„± ìë™ ê´€ë¦¬)
 */
const cartSlice = createSlice({
  name: 'cart',
  initialState,
  reducers: {

    /**
     * ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ì„¤ì •
     *
     * ìš©ë„: APIì—ì„œ ë°›ì•„ì˜¨ ì¥ë°”êµ¬ë‹ˆ ë°ì´í„°ë¡œ ìƒíƒœ ì „ì²´ë¥¼ ê°±ì‹ 
     * í˜¸ì¶œ ì‹œì : ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ ë¡œë“œ ì‹œ, ë¡œê·¸ì¸ í›„ ì¥ë°”êµ¬ë‹ˆ ë™ê¸°í™” ì‹œ
     *
     * ì²˜ë¦¬ ë¡œì§:
     * 1. items ë°°ì—´ ì „ì²´ êµì²´
     * 2. totalItems ì¬ê³„ì‚° (ëª¨ë“  ì•„ì´í…œì˜ quantity í•©ê³„)
     * 3. totalPrice ì¬ê³„ì‚° (í• ì¸ê°€ ìš°ì„  ì ìš©)
     *
     * ì‚¬ìš© ì˜ˆì‹œ:
     * dispatch(setCartItems(response.data));
     *
     * payload: CartItem[] (ë°±ì—”ë“œì—ì„œ ë°›ì€ ì¥ë°”êµ¬ë‹ˆ ë°°ì—´)
     */
    setCartItems: (state, action) => {
      // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ë°°ì—´ ì„¤ì •
      state.items = action.payload;

      // ì´ ìˆ˜ëŸ‰ ê³„ì‚°: ëª¨ë“  ì•„ì´í…œì˜ quantityë¥¼ í•©ì‚°
      // reduce(ëˆ„ì í•¨ìˆ˜, ì´ˆê¸°ê°’) - ë°°ì—´ì„ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ì¶•ì†Œ
      state.totalItems = action.payload.reduce((sum, item) => sum + item.quantity, 0);

      // ì´ ê¸ˆì•¡ ê³„ì‚°: (í• ì¸ê°€ ë˜ëŠ” ì •ê°€) Ã— ìˆ˜ëŸ‰ì˜ í•©ê³„
      // salePriceê°€ ìˆìœ¼ë©´ í• ì¸ê°€ ì‚¬ìš©, ì—†ìœ¼ë©´ ì •ê°€(price) ì‚¬ìš©
      state.totalPrice = action.payload.reduce(
        (sum, item) => sum + (item.product.salePrice || item.product.price) * item.quantity,
        0
      );
    },

    /**
     * ì¥ë°”êµ¬ë‹ˆì— ì•„ì´í…œ ì¶”ê°€
     *
     * ìš©ë„: ìƒˆ ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê±°ë‚˜, ê¸°ì¡´ ìƒí’ˆ ìˆ˜ëŸ‰ ì¦ê°€
     * í˜¸ì¶œ ì‹œì : "ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°" ë²„íŠ¼ í´ë¦­ í›„ ì„±ê³µ ì‹œ
     *
     * ì²˜ë¦¬ ë¡œì§:
     * 1. ì´ë¯¸ ê°™ì€ ìƒí’ˆì´ ìˆëŠ”ì§€ í™•ì¸ (product.idë¡œ ë¹„êµ)
     * 2. ìˆìœ¼ë©´: ê¸°ì¡´ ì•„ì´í…œì˜ quantity ì¦ê°€
     * 3. ì—†ìœ¼ë©´: ìƒˆ ì•„ì´í…œì„ ë°°ì—´ì— ì¶”ê°€ (push)
     * 4. totalItems, totalPrice ì¬ê³„ì‚°
     *
     * ì‚¬ìš© ì˜ˆì‹œ:
     * dispatch(addCartItem({ product: {...}, quantity: 2 }));
     *
     * payload: CartItem (ì¶”ê°€í•  ì•„ì´í…œ ê°ì²´)
     */
    addCartItem: (state, action) => {
      // ì´ë¯¸ ì¥ë°”êµ¬ë‹ˆì— ìˆëŠ” ìƒí’ˆì¸ì§€ í™•ì¸
      const existingItem = state.items.find(item => item.product.id === action.payload.product.id);
      
      if (existingItem) {
        // ê¸°ì¡´ ì•„ì´í…œì´ ìˆìœ¼ë©´ ìˆ˜ëŸ‰ë§Œ ì¦ê°€
        existingItem.quantity += action.payload.quantity;
      } else {
        // ìƒˆ ì•„ì´í…œì´ë©´ ë°°ì—´ì— ì¶”ê°€
        // Immer ë•ë¶„ì— push ì‚¬ìš© ê°€ëŠ¥ (ì¼ë°˜ Reduxì—ì„œëŠ” ë¶ˆê°€)
        state.items.push(action.payload);
      }
      
      // ì´ ìˆ˜ëŸ‰ ì¬ê³„ì‚°
      state.totalItems = state.items.reduce((sum, item) => sum + item.quantity, 0);

      // ì´ ê¸ˆì•¡ ì¬ê³„ì‚°
      state.totalPrice = state.items.reduce(
        (sum, item) => sum + (item.product.salePrice || item.product.price) * item.quantity,
        0
      );
    },

    /**
     * ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ìˆ˜ëŸ‰ ë³€ê²½
     *
     * ìš©ë„: ì¥ë°”êµ¬ë‹ˆì—ì„œ íŠ¹ì • ì•„ì´í…œì˜ ìˆ˜ëŸ‰ì„ ë³€ê²½
     * í˜¸ì¶œ ì‹œì : +/- ë²„íŠ¼ í´ë¦­ ë˜ëŠ” ìˆ˜ëŸ‰ ì§ì ‘ ì…ë ¥ ì‹œ
     *
     * ì²˜ë¦¬ ë¡œì§:
     * 1. cartItemIdë¡œ í•´ë‹¹ ì•„ì´í…œ ì°¾ê¸°
     * 2. quantity ì—…ë°ì´íŠ¸
     * 3. totalItems, totalPrice ì¬ê³„ì‚°
     *
     * ì‚¬ìš© ì˜ˆì‹œ:
     * dispatch(updateCartItem({ cartItemId: 1, quantity: 5 }));
     *
     * payload: { cartItemId: number, quantity: number }
     */
    updateCartItem: (state, action) => {
      const { cartItemId, quantity } = action.payload;

      // cartItemIdë¡œ ì•„ì´í…œ ì°¾ê¸°
      const item = state.items.find(item => item.id === cartItemId);
      
      if (item) {
        // ìˆ˜ëŸ‰ ì—…ë°ì´íŠ¸
        item.quantity = quantity;

        // ì´ ìˆ˜ëŸ‰ ì¬ê³„ì‚°
        state.totalItems = state.items.reduce((sum, item) => sum + item.quantity, 0);

        // ì´ ê¸ˆì•¡ ì¬ê³„ì‚°
        state.totalPrice = state.items.reduce(
          (sum, item) => sum + (item.product.salePrice || item.product.price) * item.quantity,
          0
        );
      }
    },

    /**
     * ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ì‚­ì œ
     *
     * ìš©ë„: ì¥ë°”êµ¬ë‹ˆì—ì„œ íŠ¹ì • ì•„ì´í…œ ì œê±°
     * í˜¸ì¶œ ì‹œì : "X" ë²„íŠ¼ ë˜ëŠ” "ì‚­ì œ" ë²„íŠ¼ í´ë¦­ ì‹œ
     *
     * ì²˜ë¦¬ ë¡œì§:
     * 1. filterë¡œ í•´ë‹¹ ì•„ì´í…œ ì œì™¸í•œ ìƒˆ ë°°ì—´ ìƒì„±
     * 2. totalItems, totalPrice ì¬ê³„ì‚°
     *
     * ì‚¬ìš© ì˜ˆì‹œ:
     * dispatch(removeCartItem(cartItemId));
     *
     * payload: number (ì‚­ì œí•  ì•„ì´í…œì˜ id)
     */
    removeCartItem: (state, action) => {
      // filter: ì¡°ê±´ì— ë§ëŠ” ìš”ì†Œë§Œ ë‚¨ê¸´ ìƒˆ ë°°ì—´ ë°˜í™˜
      // payload(cartItemId)ì™€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ì•„ì´í…œë§Œ ìœ ì§€
      state.items = state.items.filter(item => item.id !== action.payload);

      // ì´ ìˆ˜ëŸ‰ ì¬ê³„ì‚°
      state.totalItems = state.items.reduce((sum, item) => sum + item.quantity, 0);

      // ì´ ê¸ˆì•¡ ì¬ê³„ì‚°
      state.totalPrice = state.items.reduce(
        (sum, item) => sum + (item.product.salePrice || item.product.price) * item.quantity,
        0
      );
    },

    /**
     * ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ë¹„ìš°ê¸°
     *
     * ìš©ë„: ì¥ë°”êµ¬ë‹ˆì˜ ëª¨ë“  ì•„ì´í…œ ì‚­ì œ
     * í˜¸ì¶œ ì‹œì : "ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°" ë²„íŠ¼, ì£¼ë¬¸ ì™„ë£Œ í›„, ë¡œê·¸ì•„ì›ƒ ì‹œ
     *
     * ì²˜ë¦¬ ë¡œì§:
     * initialStateì™€ ë™ì¼í•˜ê²Œ ì´ˆê¸°í™”
     *
     * ì‚¬ìš© ì˜ˆì‹œ:
     * dispatch(clearCart());
     *
     * payload: ì—†ìŒ
     */
    clearCart: (state) => {
      state.items = [];
      state.totalItems = 0;
      state.totalPrice = 0;
    },

    /**
     * ë¡œë”© ìƒíƒœ ë³€ê²½
     *
     * ìš©ë„: API í˜¸ì¶œ ì¤‘ ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ ì œì–´
     * í˜¸ì¶œ ì‹œì : API í˜¸ì¶œ ì‹œì‘ ì‹œ true, ì™„ë£Œ ì‹œ false
     *
     * ì‚¬ìš© ì˜ˆì‹œ:
     * dispatch(setLoading(true));
     * await cartAPI.getCartItems();
     * dispatch(setLoading(false));
     *
     * payload: boolean
     */
    setLoading: (state, action) => {
      state.loading = action.payload;
    },

    /**
     * ì—ëŸ¬ ìƒíƒœ ë³€ê²½
     *
     * ìš©ë„: API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ ì €ì¥
     * í˜¸ì¶œ ì‹œì : API ì—ëŸ¬ ë°œìƒ ì‹œ, ì—ëŸ¬ í•´ì œ ì‹œ null
     *
     * ì‚¬ìš© ì˜ˆì‹œ:
     * dispatch(setError('ì¥ë°”êµ¬ë‹ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
     *
     * payload: string | null
     */
    setError: (state, action) => {
      state.error = action.payload;
    },
  },
});

/**
 * ì•¡ì…˜ ìƒì„±ì ë‚´ë³´ë‚´ê¸°
 *
 * createSliceê°€ ìë™ìœ¼ë¡œ ìƒì„±í•œ ì•¡ì…˜ ìƒì„±ìë“¤
 * ì»´í¬ë„ŒíŠ¸ì—ì„œ dispatch(setCartItems(data)) í˜•íƒœë¡œ ì‚¬ìš©
 */
export const {
  setCartItems,
  addCartItem,
  updateCartItem,
  removeCartItem,
  clearCart,
  setLoading,
  setError,
} = cartSlice.actions;

/**
 * ë¦¬ë“€ì„œ ë‚´ë³´ë‚´ê¸°
 *
 * store/index.jsì—ì„œ configureStoreì— ë“±ë¡
 * export defaultë¡œ ë¦¬ë“€ì„œ í•¨ìˆ˜ ë‚´ë³´ë‚´ê¸°
 */
export default cartSlice.reducer;


/*
 * ========================================
 * ğŸ“Œ Redux ìƒíƒœ íë¦„ ë‹¤ì´ì–´ê·¸ë¨
 * ========================================
 *
 * [ì‚¬ìš©ì ì•¡ì…˜: ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ë²„íŠ¼ í´ë¦­]
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                        React Component                              â”‚
 * â”‚                                                                     â”‚
 * â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
 * â”‚  â”‚  ProductDetail.js                                           â”‚   â”‚
 * â”‚  â”‚                                                             â”‚   â”‚
 * â”‚  â”‚  const dispatch = useDispatch();                            â”‚   â”‚
 * â”‚  â”‚                                                             â”‚   â”‚
 * â”‚  â”‚  const handleAddToCart = async () => {                      â”‚   â”‚
 * â”‚  â”‚    dispatch(setLoading(true));                              â”‚   â”‚
 * â”‚  â”‚    const result = await cartAPI.addToCart(productId, qty);  â”‚   â”‚
 * â”‚  â”‚    if (result.success) {                                    â”‚   â”‚
 * â”‚  â”‚      dispatch(addCartItem(result.data));                    â”‚   â”‚
 * â”‚  â”‚    }                                                        â”‚   â”‚
 * â”‚  â”‚    dispatch(setLoading(false));                             â”‚   â”‚
 * â”‚  â”‚  };                                                         â”‚   â”‚
 * â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
 * â”‚                             â”‚                                      â”‚
 * â”‚                             â”‚ dispatch(addCartItem(data))          â”‚
 * â”‚                             â†“                                      â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                               â”‚
 *                               â†“
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                        Redux Store                                  â”‚
 * â”‚                                                                     â”‚
 * â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
 * â”‚  â”‚  Action                                                     â”‚   â”‚
 * â”‚  â”‚  {                                                          â”‚   â”‚
 * â”‚  â”‚    type: 'cart/addCartItem',                                â”‚   â”‚
 * â”‚  â”‚    payload: { product: {...}, quantity: 2 }                 â”‚   â”‚
 * â”‚  â”‚  }                                                          â”‚   â”‚
 * â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
 * â”‚                             â”‚                                      â”‚
 * â”‚                             â†“                                      â”‚
 * â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
 * â”‚  â”‚  cartSlice Reducer                                          â”‚   â”‚
 * â”‚  â”‚                                                             â”‚   â”‚
 * â”‚  â”‚  addCartItem: (state, action) => {                          â”‚   â”‚
 * â”‚  â”‚    // 1. ê¸°ì¡´ ì•„ì´í…œ í™•ì¸                                     â”‚   â”‚
 * â”‚  â”‚    const existing = state.items.find(...);                  â”‚   â”‚
 * â”‚  â”‚                                                             â”‚   â”‚
 * â”‚  â”‚    // 2. ì•„ì´í…œ ì¶”ê°€ ë˜ëŠ” ìˆ˜ëŸ‰ ì¦ê°€                            â”‚   â”‚
 * â”‚  â”‚    if (existing) {                                          â”‚   â”‚
 * â”‚  â”‚      existing.quantity += action.payload.quantity;          â”‚   â”‚
 * â”‚  â”‚    } else {                                                 â”‚   â”‚
 * â”‚  â”‚      state.items.push(action.payload);                      â”‚   â”‚
 * â”‚  â”‚    }                                                        â”‚   â”‚
 * â”‚  â”‚                                                             â”‚   â”‚
 * â”‚  â”‚    // 3. ì´ê³„ ì¬ê³„ì‚°                                         â”‚   â”‚
 * â”‚  â”‚    state.totalItems = state.items.reduce(...);              â”‚   â”‚
 * â”‚  â”‚    state.totalPrice = state.items.reduce(...);              â”‚   â”‚
 * â”‚  â”‚  }                                                          â”‚   â”‚
 * â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
 * â”‚                             â”‚                                      â”‚
 * â”‚                             â†“                                      â”‚
 * â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
 * â”‚  â”‚  New State                                                  â”‚   â”‚
 * â”‚  â”‚  {                                                          â”‚   â”‚
 * â”‚  â”‚    items: [{ product: {...}, quantity: 2 }, ...],           â”‚   â”‚
 * â”‚  â”‚    totalItems: 5,                                           â”‚   â”‚
 * â”‚  â”‚    totalPrice: 150000,                                      â”‚   â”‚
 * â”‚  â”‚    loading: false,                                          â”‚   â”‚
 * â”‚  â”‚    error: null                                              â”‚   â”‚
 * â”‚  â”‚  }                                                          â”‚   â”‚
 * â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
 * â”‚                             â”‚                                      â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                               â”‚
 *                               â”‚ ìƒíƒœ ë³€ê²½ ì•Œë¦¼ (ìë™)
 *                               â†“
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                   êµ¬ë… ì¤‘ì¸ ì»´í¬ë„ŒíŠ¸ë“¤ (ìë™ ë¦¬ë Œë”ë§)                 â”‚
 * â”‚                                                                     â”‚
 * â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
 * â”‚  â”‚ Cart.js     â”‚  â”‚ Header.js   â”‚  â”‚ CartFloatingButton.js       â”‚  â”‚
 * â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                             â”‚  â”‚
 * â”‚  â”‚ useSelector â”‚  â”‚ useSelector â”‚  â”‚ useSelector                 â”‚  â”‚
 * â”‚  â”‚ (items)     â”‚  â”‚ (totalItems)â”‚  â”‚ (totalItems)                â”‚  â”‚
 * â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                             â”‚  â”‚
 * â”‚  â”‚ ëª©ë¡ í‘œì‹œ    â”‚  â”‚ ë°°ì§€: 5     â”‚  â”‚ ë°°ì§€: 5                      â”‚  â”‚
 * â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
 * â”‚                                                                     â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *
 * ========================================
 * ğŸ“Œ ê¸ˆì•¡ ê³„ì‚° ë¡œì§ ìƒì„¸
 * ========================================
 *
 * totalPrice ê³„ì‚° ê³µì‹:
 * Î£ (salePrice || price) Ã— quantity
 *
 * ì˜ˆì‹œ:
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚  items = [                                                        â”‚
 * â”‚    { product: { price: 10000, salePrice: 8000 }, quantity: 2 },   â”‚
 * â”‚    { product: { price: 5000, salePrice: null }, quantity: 3 }     â”‚
 * â”‚  ]                                                                â”‚
 * â”‚                                                                   â”‚
 * â”‚  ê³„ì‚°:                                                             â”‚
 * â”‚  ì•„ì´í…œ1: 8000 (í• ì¸ê°€ ìˆìŒ) Ã— 2 = 16,000ì›                         â”‚
 * â”‚  ì•„ì´í…œ2: 5000 (í• ì¸ê°€ ì—†ìŒ) Ã— 3 = 15,000ì›                         â”‚
 * â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
 * â”‚  totalPrice = 31,000ì›                                            â”‚
 * â”‚  totalItems = 2 + 3 = 5ê°œ                                         â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *
 * ========================================
 * ğŸ“Œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš© ì˜ˆì‹œ
 * ========================================
 *
 * // ìƒíƒœ ì½ê¸° (useSelector)
 * import { useSelector } from 'react-redux';
 *
 * const Cart = () => {
 *   const { items, totalPrice, loading } = useSelector(state => state.cart);
 *
 *   if (loading) return <Spinner />;
 *
 *   return (
 *     <div>
 *       {items.map(item => <CartItem key={item.id} item={item} />)}
 *       <p>ì´ ê¸ˆì•¡: {totalPrice.toLocaleString()}ì›</p>
 *     </div>
 *   );
 * };
 *
 *
 * // ìƒíƒœ ë³€ê²½ (useDispatch)
 * import { useDispatch } from 'react-redux';
 * import { removeCartItem, updateCartItem } from '../store/slices/cartSlice';
 *
 * const CartItem = ({ item }) => {
 *   const dispatch = useDispatch();
 *
 *   const handleDelete = () => {
 *     dispatch(removeCartItem(item.id));
 *   };
 *
 *   const handleQuantityChange = (newQty) => {
 *     dispatch(updateCartItem({ cartItemId: item.id, quantity: newQty }));
 *   };
 *
 *   return (...);
 * };
 *
 *
 * ========================================
 * ğŸ“Œ API ì—°ë™ íŒ¨í„´
 * ========================================
 *
 * // ì¥ë°”êµ¬ë‹ˆ ë¡œë“œ (API â†’ Redux)
 * const loadCart = async () => {
 *   dispatch(setLoading(true));
 *   try {
 *     const result = await cartAPI.getCartItems();
 *     if (result.success) {
 *       dispatch(setCartItems(result.data));
 *     } else {
 *       dispatch(setError(result.message));
 *     }
 *   } catch (error) {
 *     dispatch(setError('ì¥ë°”êµ¬ë‹ˆ ë¡œë“œ ì‹¤íŒ¨'));
 *   } finally {
 *     dispatch(setLoading(false));
 *   }
 * };
 *
 * // ì•„ì´í…œ ì‚­ì œ (API í˜¸ì¶œ í›„ Redux ì—…ë°ì´íŠ¸)
 * const deleteItem = async (cartItemId) => {
 *   const result = await cartAPI.removeItem(cartItemId);
 *   if (result.success) {
 *     dispatch(removeCartItem(cartItemId));  // ë¡œì»¬ ìƒíƒœë„ ì—…ë°ì´íŠ¸
 *   }
 * };
 *
 */
